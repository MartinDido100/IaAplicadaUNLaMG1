    <section class="recommendations">
    <div class="title">
        <h2>Tu proxima pelicula <br> <span>te esta esperando</span> </h2>
        <span>Descubre un universo cinematográfico infinito. Explora, filtra y encuentra <br> exactamente lo que buscas en nuestro catálogo inteligente.</span>
    </div>
    
    <div class="history-panel">
        <div class="history-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
                <path d="M12 7v5l4 2"/>
            </svg>
            <h4>Historial de selecciones</h4>
        </div>
        
        <div class="history-content">
            <div class="history-list">
                <!-- Lista dinámica - se llenará con data del componente -->
                @for (item of preferences(); track item.tmdbId) {
                    <div class="history-item">
                        <span class="movie-title">{{item.name}}</span>
                        <span class="selection-time">{{ item.date | timeAgo }}</span>
                    </div>
                }
                <!-- Placeholder para cuando no hay historial -->
                @if (preferences().length === 0) {
                    <div class="empty-history">
                        <span>No hay películas recientes</span>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="gemini-prompt">
        <h3>Encuentra tu pelicula perfecta</h3>

        <form class="ia-form" [formGroup]="iaForm" (ngSubmit)="onSubmit()">
            <div class="form-field">
                <label for="textPrompt" class="form-label prompt-label">¿Cómo te sientes hoy? Cuéntame tu estado de ánimo y yo encontraré la película perfecta ✨</label>
                <textarea formControlName="textPrompt" placeholder="Escribe aquí tu estado de ánimo..." id="textPrompt" name="textPrompt"></textarea>
            </div>

            <div class="advanced-search-toggle">
                <button type="button" class="toggle-btn" (click)="toggleAdvancedSearch()">
                    <span>{{ showAdvancedSearch() ? 'Ocultar búsqueda avanzada' : 'Búsqueda avanzada' }}</span>
                    <svg class="toggle-icon" [class.rotated]="showAdvancedSearch()" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 9l6 6 6-6"/>
                    </svg>
                </button>
            </div>

            <div class="advanced-filters" [class.hidden]="!showAdvancedSearch()">
                <div class="filters-content">
                    <div class="form-field">
                        <span class="form-label">Genero de la pelicula</span>
                        <div class="radio-group">
                        @for (genre of movieService.genres(); track $index) {
                                <label>
                                    <input type="checkbox" name="genre" [value]="genre.name" (change)="onCheckboxChange($event, 'genres')" />
                                    {{ genre.name }}
                                </label>
                        }
                        </div>
                    </div>

                    <div class="form-field">
                        <span class="form-label">Estado de ánimo objetivo</span>
                        <div class="radio-group">
                        @for (mood of moods; track $index) {
                                <label>
                                    <input type="checkbox" name="mood" [value]="mood" (change)="onCheckboxChange($event, 'moods')" />
                                    {{ mood | titlecase }}
                                </label>
                            }
                        </div>
                    </div>

                    <div class="form-field radios">
                        <span class="form-label">Duración de la película</span>
                        <div class="radio-group">
                        @for (duration of durations; track $index) {
                                <label>
                                    <input type="checkbox" name="duration" [value]="duration" (change)="onCheckboxChange($event, 'durations')" />
                                    {{ duration | titlecase }}
                                </label>
                            }
                        </div>
                    </div>

                    <div class="form-field">
                        <span class="form-label">Audiencia objetivo</span>
                        <div class="radio-group">
                            @for (audience of audiences; track $index) {
                                <label>
                                    <input type="checkbox" name="audience" [value]="audience" (change)="onCheckboxChange($event, 'audiences')" />
                                    {{ audience | titlecase }}
                                </label>
                            }
                        </div>
                    </div>
                </div>
            </div>

            @if (loading()) {
                <app-spinner [height]="30" [width]="30"></app-spinner>
            }
            @else {
                <button>
                    <span>Buscar peliculas con IA ✨</span>
                </button>
            }
        </form>
    </div>
</section>